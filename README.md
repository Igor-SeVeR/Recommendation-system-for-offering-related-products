# Рекомендательная система предложения сопутствующих товаров

Система с моделью машинного обучения, может применяться в компаниях из сферы ритейла для прогнозирования интересов покупателя и рекомендации ему для покупки сопутствующих товаров на основе информации о текущем состоянии корзины покупок и исторической информации о покупках клиентов. 

## Руководство пользователя

### Установка системы

Перед началом работы пользователю необходимо установить на свой локальный компьютер или сервер (поддерживается только ОС Linux), где будет размещен проект, <b>Python 3.9</b> и инструменты <b>pip</b>, <b>pipenv</b>, <b>make</b>. Они необходимы для обеспечения работоспособности и взаимодействия программы: pip необходим для установки всех нужных проекту зависимостей, pipenv – для создания виртуального окружения, а make – для запуска команд, управляющих работой программы.

Для начала работы с программным продуктом необходимо склонировать проект, после чего перейти в его корневую папку и активировать виртуальное окружение командами:

```bash
python3.9 -m venv venv
. venv/bin/activate
```

После этого необходимо установить все необходимые зависимости для проекта. Делается это автоматически, с помощью выполнения команды devel, после исполнения которой все зависимости проекта будут установлены и проект будет готов к использованию:

```bash
make devel
```

Управление проектом осуществляется посредством исполнения консольных команд. Синтаксис команд можно уточнить, выполнив команду:

```bash
nano Makefile
```

### Управление системой

В начале непосредственной работы с системой необходимо добавить в неё нового пользователя. Только авторизованный пользователь может посылать запросы и получать ответ от системы. Для регистрации нового пользователя существует команда ```add_user``` с параметрами: имя пользователя, пароль, полное имя и почта:

```bash
make add_user USER_NAME={имя пользователя} PASSWORD={пароль} FULL_NAME={полное имя} EMAIL={пароль}
```

Также существует возможность удалить пользователя по его USER_NAME:

```bash
make del_user USER_NAME={имя пользователя}
```

После того, как пользователь зарегистрировался с помощью команды add_user, он может приступить к обучению модели. Для этого ему понадобится файл с данными об истории покупок пользователей в формате *.xlsx или *.csv с разделителем «,». Важно, что файл должен обязательно содержать колонки с определенной информацией, которые должны быть названы следующим образом:

+ InvoiceNo – идентификатор транзакции (покупки)
+ StockCode – идентификатор продукта
+ Description – название продукта
+ CustomerID – идентификатор пользователя

Другие колонки также могут быть, но они не будут влиять на обучение модели.

Для обучения модели пользователь использует команду train, указывая при этом путь до файла с данными:

```bash
make train PATH_TO_DATA={путь до файла с данными}
```

В процессе пользователю будут выводиться сообщения о ходе выполнения команды и сопутствующая информация. После завершения обучения файлы модели будут сохранены в папке data и доступны для использования.

Наконец, пользователь может перейти к запуску сервера. Существуют две команды для запуска системы: ```run``` и ```run-prod```. 

Команда ```run``` запускает сервер как основной процесс, то есть при этом логи будут выводиться на основной экран, и проводить другие операции на сервере будет невозможно без прекращения его работы сочетанием клавиш ```ctrl+C```. 

Команда ```run-prod``` запускает сервер в фоновом режиме, так что на нем можно будет продолжать работу, например обучить новую модель. При этом рекомендательная система будет работать параллельно до тех пор, пока пользователь сам не захочет остановить ее командой ```kill```. 

Синтаксис последовательности команд:

```bash
make run
ctrl + C
```

```bash
make run-prod
make kill
```

Последнее, что осталось рассмотреть – возможность обучения модели во время работы сервера. Для этого, как было описано выше, сервер должен быть запущен в фоновом режиме командой run-prod. Также используются команды ```train_parallel``` непосредственно для обучения и ```load_after_parallel_train``` для автоматической замены актуальных файлов модели. Последовательность команд в этом случае:

```bash
make run-prod
make train_parallel PATH_TO_DATA={путь до файла с данными}
make kill
make load_after_parallel_train
make run-prod
```

### Взаимодействие с API

Во время работы сервера пользователь имеет возможность общаться с ним посредством API. 

Пользователю доступны три метода:

+ /send_data – для непосредственного получения рекомендаций
+ /token – для авторизации
+ /users/me – для проверки авторизации, получения информации о пользователе




